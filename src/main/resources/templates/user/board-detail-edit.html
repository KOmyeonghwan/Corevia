<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <meta name="_csrf" content="{{_csrf.token}}">
    <meta name="_csrf_header" content="{{_csrf.headerName}}">
    <link rel="stylesheet" href="/user/css/common.css">
    <link rel="stylesheet" href="/user/css/board-detail-edit.css">
    <script src="/user/js/board-detail-edit.js"></script>

    <title>board</title>
</head>

<body>
    <header>
        <div class="logo">
            <img src="/user/images/logo.png" alt="CoreNet">
        </div>
        <div data-position="{{loginUser.positionLevel}}">
            {{loginUser.userName}} 님
            <form action="/adminuser" method="get" class="isAdmin" style="display:inline;">
                <button type="submit" class="adminBtn">관리자</button>
            </form>
            <form action="/logout" method="post" style="display:inline;">
                <input type="hidden" name="_csrf" value="{{_csrf.token}}">
                <button type="submit" class="logoutBtn">로그아웃</button>
            </form>

        </div>

    </header>

    <main>
        {{> fragments/usernav}}

        <div class="main-view">
            <h2>게시글 수정</h2>
            <form class="edit-form" action="/boarddetailedit" method="post" enctype="multipart/form-data">
                <input type="hidden" name="{{_csrf.parameterName}}" value="{{_csrf.token}}">
                
                <!-- 반드시 필요: postId -->
                <input type="hidden" name="postId" value="{{post.id}}">
                
                <!-- 로그인 사용자 레벨 (컨트롤러에서 positionLevel 사용) -->
                <input type="hidden" name="positionLevel" value="{{loginUser.positionLevel}}">
            
                <div class="detail-item">
                    <label for="title">제목</label>
                    <input type="text" id="title" name="title" value="{{post.title}}">
                </div>
                <div class="detail-item">
                    <label for="author">작성자</label>
                    <input type="text" value="{{post.userName}}" readonly>
                </div>
                <div class="detail-item">
                    <label for="category">카테고리</label>
                    <input type="text" name="boardCode" value="{{post.boardCode}}" readonly>
                </div>
                <div class="detail-item">
                    <label for="content">내용</label>
                    <textarea id="commentContent" name="content" rows="5">{{post.content}}</textarea>
                </div>
            
                <div class="detail-item">
                    <label for="file">첨부파일</label>
                    
                    <!-- 기존 첨부파일 링크 -->
                    {{#post.fileUrl}}
                    <ul>
                        <li>
                            <a href="{{post.fileUrl}}" target="_blank">{{post.fileName}}</a>
                        </li>
                    </ul>
                    {{/post.fileUrl}}
            
                    <!-- 새 파일 업로드 input -->
                    <input type="file" name="boardFile" id="file">
            
                    <!-- 기존 파일 정보 hidden -->
                    <input type="hidden" name="existingFileUrl" value="{{post.fileUrl}}">
                    <input type="hidden" name="existingFileName" value="{{post.fileName}}">
                </div>
            
                <div class="form-buttons">
                    <button type="submit">저장</button>
                    <button type="button" onclick="location.href='/userboarddetail/{{post.boardCode}}/{{post.id}}'">취소</button>
                </div>
            </form>
            
        </div>

    </main>

    <script src="/user/js/common.js"></script>

</body>

</html>

<!-- ui -> 9월 25일까지 완성
 spring 생성 및 환경 세팅: 26일 
 이후 -> 백엔드
 -->