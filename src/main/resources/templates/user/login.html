<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" content="{{_csrf.token}}">
    <meta name="_csrf_header" content="{{_csrf.headerName}}">
    <link rel="stylesheet" href="/user/css/common.css">
    <link rel="stylesheet" href="/user/css/login.css">
    <script src="/user/js/login.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>로그인</title>
</head>

<body>
    <!-- 로그인 시 근태 관리 기능 동작해야 됨(1일 최초 로그인 시, 시간 admin으로 넘기기) -->
    <header>
        <div class="logo">
            <img src="/user/images/logo.png" alt="CoreNet">
        </div>
        <div> 로그인</div>
        {{#error}}
        <script>
            const errMsg = "{{error}}".replace(/"/g, '\\"'); // 큰따옴표 처리
            alert(errMsg);
        </script>
        {{/error}}

        {{#loginSuccessMsg}}
        <script>
            const msg = "{{loginSuccessMsg}}".replace(/"/g, '\\"');
            alert(msg);
            window.location.href = "{{redirectUrl}}"; // 로그인 성공 시 이동
        </script>
        {{/loginSuccessMsg}}

    </header>

    <main>
        <form action="/login" method="post">
            <input type="hidden" name="{{_csrf.parameterName}}" value="{{_csrf.token}}">
            <h2>로그인</h2>
            <label for="id">ID</label>
            <input type="text" id="id" name="userId" placeholder="아이디를 입력하세요."><br>
            <label for="PW">PW</label>
            <input type="password" id="password" name="password" placeholder="비밀번호를 입력하세요.">
            <button type="submit">로그인</button>
            <span>
                <a href="#" id="openFindIdModal">ID 찾기</a>&nbsp;﹒
                <a href="#" id="openSignupModal">회원가입</a>
            </span>

        </form>
    </main>

    <!-- 회원 가입 모달 -->
    <div id="signup-modal" class="signup-modal modal">
        <form id="signupForm" action="/register" method="post">
            <input type="hidden" name="{{_csrf.parameterName}}" value="{{_csrf.token}}">

            <span class="close">&times;</span>
            <h2>회원가입</h2>

            <label for="userId">아이디</label>
            <input type="text" id="register-userId" name="userId" required />
            <p class="errorMsg idErrMsg"></p>

            <label for="email">이메일</label>
            <div class="email-fields">
                <input type="text" id="register-email" name="email" required />
                <span class="email-at">@</span>

                <select id="register-email-domain" name="emailDomain" required>
                    <option value="gmail.com" selected>gmail.com</option>
                    <option value="naver.com">naver.com</option>
                    <option value="kakao.com">kakao.com</option>
                </select>
            </div>
            <p class="errorMsg emailErrMsg"></p>

            <label for="name">이름</label>
            <input type="text" id="register-name" name="name" placeholder="홍길동" required />
            <p class="errorMsg nameErrMsg"></p>

            <label for="phone">전화번호</label>
            <input type="tel" id="register-phone" name="phone" placeholder="01012345678" required />
            <p class="errorMsg phoneErrMsg"></p>

            <label for="register-password">비밀번호</label>
            <input type="password" id="register-password" name="password" required />
            <p class="errorMsg pwErrMsg"></p>

            <label for="register-department">부서</label>
            <select id="register-department" name="department_id" required>
                <option value="">선택하세요</option>
                {{#departments}}
                <option value="{{id}}">{{departmentName}}</option>
                {{/departments}}
            </select>

            <button type="submit">가입하기</button>
        </form>
    </div>

    <!-- 아이디 찾기 모달 -->
    <div id="find-id-modal" class="find-id-modal modal">
        <form id="findIdForm" action="/findId" method="post">
            <input type="hidden" name="{{_csrf.parameterName}}" value="{{_csrf.token}}">

            <span class="close">&times;</span>
            <h2>아이디 찾기</h2>
            <label for="find-name">이름</label>
            <input type="text" id="find-name" name="name" required />

            <!-- <label for="reset-email">이메일</label>
            <div class="email-fields">
                <input type="text" id="find-email" name="email" required />
                <span class="email-at">@</span>
                <input type="text" value="corenet.com" disabled />
            </div> -->

            <label for="find-name">이메일</label>
            <div class="email-fields">
                <input type="text" id="find-email" name="email" required />
                <span class="email-at">@</span>
                <select name="emailDomain" id="email-domain" required>
                    <option value="gmail.com" selected>gmail.com</option>
                    <option value="naver.com">naver.com</option>
                    <option value="kakao.com">kakao.com</option>
                </select>
            </div>

            <button type="submit">아이디 찾기</button>
        </form>
    </div>


    <!-- 결과 모달 -->
    <div id="resultModal" class="modal hidden" style="
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.5);
        align-items: center;
        justify-content: center;
    ">
        {{#resultMessage}}
        <div class="modal-content" style="
        position: relative;
        background-color: #fff;
        margin: auto;
        padding: 20px 30px;
        border-radius: 12px;
        width: 300px;
        max-width: 90%;
        text-align: center;
        animation: fadeIn 0.3s ease-in-out;
    ">
            <!-- 닫기 버튼 -->
            <span id="closeModal" style="
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        ">&times;</span>
            {{{resultMessage}}}
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const modal = document.getElementById("resultModal");
                const closeBtn = document.getElementById("closeModal");

                modal.classList.remove("hidden");
                modal.style.display = "flex";

                closeBtn.addEventListener("click", () => {
                    modal.style.display = "none";
                });

                // 모달 바깥 클릭 시 모달 닫기
                modal.addEventListener("click", (e) => {
                    if (e.target === modal) {
                        modal.style.display = "none";
                    }
                });
            });
        </script>
        {{/resultMessage}}
    </div>

    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>


</body>

</html>